<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamified Schedule</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center text-yellow-400">Quest Log</h1>
        <div id="schedule-container" class="space-y-4"></div>
    </div>

    <script>
        async function loadSchedule() {
            try {
                const response = await fetch('schedule.json');
                const events = await response.json();
                const container = document.getElementById('schedule-container');

                // Sort events by start date
                events.sort((a, b) => new Date(a.start) - new Date(b.start));

                events.forEach(event => {
                    const eventDiv = document.createElement('div');
                    eventDiv.className = 'bg-gray-800 rounded-lg p-6 border border-gray-700 shadow-lg mb-4';

                    const date = event.start ? new Date(event.start).toLocaleString() : 'No Date';

                    let tasksHtml = '';
                    if (event.tasks && event.tasks.length > 0) {
                        tasksHtml = '<div class="mt-4 space-y-2 border-t border-gray-700 pt-4">';
                        tasksHtml += '<h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider">Sub-Quests</h3>';
                        event.tasks.forEach(task => {
                            const checked = task.completed ? 'checked' : '';
                            tasksHtml += `
                                <div class="flex items-start space-x-3 p-2 bg-gray-900/50 rounded">
                                    <input type="checkbox" ${checked} class="mt-1 form-checkbox h-5 w-5 text-yellow-500 rounded focus:ring-0 bg-gray-700 border-gray-600" disabled>
                                    <span class="${task.completed ? 'line-through text-gray-500' : 'text-gray-200'}">${task.text}</span>
                                </div>
                            `;
                        });
                        tasksHtml += '</div>';
                    }

                    // Highlight the specific task from the prompt
                    if (event.summary.includes("Self-care planning for intense weeks ahead")) {
                        eventDiv.classList.add('border-yellow-500', 'border-2');
                    }

                    eventDiv.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <h2 class="text-xl font-semibold text-blue-300">${event.summary}</h2>
                                <p class="text-gray-400 text-sm mt-1">${date}</p>
                                <div class="text-gray-300 mt-2 text-sm whitespace-pre-wrap font-mono bg-gray-900 p-2 rounded">${event.description}</div>
                            </div>
                        </div>
                        ${tasksHtml}
                    `;

                    container.appendChild(eventDiv);
                });
            } catch (error) {
                console.error('Error loading schedule:', error);
                document.getElementById('schedule-container').innerHTML = '<p class="text-red-500 text-center">Failed to load quest log. Make sure schedule.json is generated.</p>';
            }
        }

        loadSchedule();
    </script>
</body>
</html>
